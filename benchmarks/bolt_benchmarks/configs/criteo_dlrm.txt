# We have two criteo benchmarks because the datasets are slightly different in input dimension.

experiment_identifier = "Criteo DLRM 46M"
model_identifier = "criteo_dlrm"
dataset_identifier = "criteo_click_through_46M"


train_metrics = []
epochs = 5
reconstruct_hash_functions = 6400
rebuild_hash_tables = 128000
learning_rate = 0.0001
loss_fn = "CategoricalCrossEntropyLoss"
test_metrics = ["categorical_accuracy"]
compute_roc_auc = true

[[datasets]]
format = "click"
type_list = ["train_data", "train_data", "train_labels"]
path = "criteo/train_shuf.txt"
batch_size = 512
max_num_numerical_features = 13
max_categorical_features = 26
delimiter = " "

[[datasets]]
format = "click"
type_list = ["test_data", "test_data", "test_labels"]
path = "criteo/test_shuf.txt"
batch_size = 256
max_num_numerical_features = 13
max_categorical_features = 26
delimiter = " "

[[datasets]]
format = "click_labels"
type_list = ["test_labels_np"]
path = "criteo/test_shuf.txt"

[[nodes]]
type = "Input"
name = "numerical_input"
dim = 13

[[nodes]]
type = "FullyConnected"
name = "hidden1"
pred = "numerical_input"
dim = 1000
sparsity = 0.2
activation = "relu"
# Use random sampling because it speeds up training without impacting convergence.
use_random_sampling = true

[[nodes]]
type = "FullyConnected"
name = "hidden2"
pred = "hidden1"
dim = 100
activation = "relu"

[[nodes]] 
type = "Input"
name = "categorical_input"
dim = 4294967295
min_num_nonzeros = 26
max_num_nonzeros = 26

[[nodes]]
type = "Embedding"
name = "embedding"
pred = "categorical_input"
num_embedding_lookups = 8
lookup_size = 16
log_embedding_block_size = 20
reduction="concat"
num_tokens_per_input=26

[[nodes]]
type = "Concatenate"
name = "concat"
preds = ["hidden2", "embedding"]

[[nodes]] 
type = "FullyConnected"
name = "hidden3"
pred = "concat"
dim = 1000
sparsity = 0.2
activation = "relu"
# Use random sampling because it speeds up training without impacting convergence.
use_random_sampling = true

[[nodes]]
type = "FullyConnected"
name = "output"
pred = "hidden3"
dim = 2
activation = "softmax"
